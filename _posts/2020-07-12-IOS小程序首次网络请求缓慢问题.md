---
title: 小程序首页加载缓慢问题
date: 2020-07-12 20:53:38
tags: 小程序
categories: 技术
---

> 记录一次不寻常问题的解决过程

自从公司内小程序改版后，用户有反馈一个问题，首页加载特别缓慢。  
对于这个问题的出现其实是挺费解的，小程序改版变动的只是在UI层面上，业务逻辑相关并没有做太大变更，加上在开发工具上开发时也并没有感觉到慢。

## 问题分析

就着这个问题，我用体验版小程序进行了测试

- 从小程序首页进入小程序
- 从分享页进入小程序
- 从分享页进入小程序后，再进入到首页

通过三种流程比较，发现不止是首页加载缓慢，只要是刚进入小程序，加载就会特别慢。  
而通过分享页进入小程序后再进入到首页，加载却没有问题。  
通过真机调试后发现，首次网络请求在真机上的时间需要最少3秒，这在IOS上是必现的，而在Android机上是没有问题的。  
所以目前问题基本定位成**IOS首次网络加载慢**。

## 找资料

在微信开放社区中，找到了如下的信息  
[整个小程序在首次网络请求时候，第一条请求速度很慢？](https://developers.weixin.qq.com/community/develop/doc/00004a8ae4c0c008595a5cc8b5b800?highLine=IOS%25E9%25A6%2596%25E6%25AC%25A1%25E5%258A%25A0%25E8%25BD%25BD%25E6%2585%25A2)  
[微信小程序IOS上第一次请求慢的问题](https://developers.weixin.qq.com/community/develop/doc/000a6661b689981bc57a82a925b800?_at=1563252586956)


百度上找到如下问答  
[小程序在 ios 下请求 api 很慢, 安卓和模拟器很快, 求解](https://www.v2ex.com/t/662189)

在这里面都指向了同一个原因，Https安全证书。  
我们目前的确是**Let's encrpyt证书**


## 解决方案

勾搭上运维小哥，让他替换了安全证书后，果然提速。  
最终原因定位在了**国内Let's Encrypt的 OSCP域名的解析被污染**。